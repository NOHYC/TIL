# heapq

### 1. 힙 자료구조

> heapq 모듈은 이진트리 기반 최소 힙 자료 구조를 제공한다. 
>
> min heap을 사용하면 원소들이 항상 정렬된 상태로 추가되고 삭제되며, min heap에서 가장 작은 값은 언제나 인덱스 0. 즉, 이진 트리의 루트에 위치한다. 내부적으로 min heap 내의 모든 원소(k)는 항상 자식 원소(2k+1,2k+2)들 보다 크기가 작거나 같도록 원소가 추가되고 삭제된다.

```python
heap[k] <= heap[2*k+1] and heap[k] <= heap[2*k+2]
```

> 위 공식을 만족시키는 간단한 min heap 구조이다.

```python
     1  ---> root
   /   \
  3     5
 / \   /
4   8 7
```

### 2. 모듈 임포트

> 우선 heapq 모듈은 내장 모듈이기 때문에 파이썬만 설치되어 있으면 임포트 후에 힙 관련 함수를 사용할  수 있다. ( import heapq )

### 3.  최소 힙 생성

> heapq 모듈에는 파이썬의 보통 리스트를 마치 최소 힙처럼 다룰 수 있도록 도와준다. 
>
> 그렇기 때문에, 빈 리스트를 생성해놓은 다음 heapq 모듈의 함수를 호출할 때마다 이 리스트를 인자로 넘겨야한다. 다시말해, 파이썬에서는 heapq모듈을 통해서 원소를 추가하거나 삭제한 리스트가 최소 힙이다.

### 4. 원소 추가

> heapq모듈의 heappush() 함수를 이용하여 힙에 원소를 추가할 수 있다. 첫번째 인자는 원소를 추가할 대상 리스트이며 두번째 인자는 추가할 원소를 넘긴다.

```python
import heapq
heap = []
heapq.heappush(heap,4)
heapq.heappush(heap,1)
heapq.heappush(heap,7)
heapq.heappush(heap,3)
print(heap)
```

```python
[1,3,7,4]
```

> 가장 작은 1이 인덱스 0에 위치하며 인덱스 1(k)에 위치한 3은 인덱스 3(=2k+1)에 위치한 4보다 크기 때문에 힙의 공식을 만족한다. 내부적으로 이진 트리에 원소를 추가하는 heappush() 함수는 O(logN)의 시간 복잡도를 가진다.

### 5. 원소 삭제

> heapq 모듈의 heappop() 함수를 이용하여 힙에서 원소를 삭제할 수 있다 원소를 삭제할 대상 리스트를 인자로 넘기면 가장 작은 원소를 삭제 후 그 값을 리턴한다.

```python
print(heapq.heappop(heap))
print(heap)
print(heapq.heappop(heap))
print(heap)
```

```python
1
[3,4,7]
3
[4,7]
```

### 6. 최소값 삭제하지 않고 읽기

> 힙에서 최소값을 삭제하지 않고 단순히 읽기만 하려면 일반적으로 리스트의 첫번째 원소에 접근하듯 인덱스를 통해 접근하면된다.

```python
print(heap[0])
```

```python
4
```

> 여기서 주의할 점은 인덱스 0에 가장 작은 원소가 있다고 해서 작은 순으로 정렬되어 있다는 보장이 없다. 왜냐하면 힙은 heappop() 함수를 호출하여 원소를 삭제할 때마다 이진 트리의 재배치를 통해 매번 새로운 최소값을 인덱스 0에 위치시키기 때문이다.

### 7. 기존 리스트를 힙으로 변환

> 이미 원소가 들어있는 리스트를 힙으로 만들려면 heapq모듈의 heapify()라는 함수에 사용하면된다.

```python
heap = [4,1,7,3,8,5]
heap.heapify(heap)
print(heap)
```

```python
[1,3,5,4,8,7]
```

> heapify() 함수에 리스트 인자로 넘기면 리스트 내부의 원소들의 위에서 다룬 힙 구조에 맞게 재배치되며 최소값이 0번째 인덱스에 위치하게 된다. 즉, 비어있는 리스트 생성 후 heappush() 함수로 원소를 하나씩 추가한 효과가 나타난다. heapify() 함수의 성능은 인자로 넘기는 리스트의 원소 수에 비례한다. 즉, O(N)의 시간 복잡도를 가진다.

### 8. 최대힙

> heapq 모듈은 최소힙 기능만으로 동작하기 때문에 최대 힙으로 사용하려면 약간의 요령이 필요하다. 힙에 튜플을 원소로 추가하거나 삭제하면, 튜플 내에서 맨 앞에 있는 값을 기준으로 최소힙이 구성되는 원리를 이용한 것이다.
>
> 따라서, 최대 힙을 만들려면 각 값에 대한 우선 순위를 구한 후, (우선 순위, 값) 구조의 튜플을 힙에 추가하거나 삭제하면된다. 그리고 힙에서 값을 읽어올 때는 각 튜플에서 인덱스 1에 있는 값을 취하면 된다.

```python
import heapq
nums = [4,1,7,3,8,5]
heap = []
for num in nums:
    heapq.heappush(heap,(-num,num))

while heap:
    print(heap.heappop(heap)[1])
```

```python
8
7
5
4
3
1
```

